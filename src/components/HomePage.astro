---
// HomePage component - renders all page sections
// Content is English by default; translations can be handled via props or i18n later
---

<!-- Hero -->
<section class="hero">
  <div class="hero-content">
    <div class="hero-text">
      <h1>Your health, <em>finally</em> understood</h1>
      <p class="hero-subtitle">
        We take your discharge summaries, lab results, and medical records
        and make them easy to understand and explore with clear summaries,
        visual explanations, and answers when you need them.
      </p>
      <div class="hero-cta-group">
        <a href="#signup" class="btn-primary">Join the Waitlist</a>
        <a href="#" class="btn-secondary" id="videoModalTrigger">
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M6 4L12 8L6 12V4Z"
              fill="currentColor"
              stroke="currentColor"
              stroke-width="1"
              stroke-linejoin="round"
            />
          </svg>
          See a 2 min Demo
        </a>
      </div>
    </div>
    <div class="hero-image-wrapper">
      <img
        src="/img/icons-lg/icon-schedule.png"
        alt="Obtego schedule icon"
        class="hero-icon hero-icon-schedule"
      />
      <img
        src="/img/icons-lg/icon-meds.png"
        alt="Obtego meds icon"
        class="hero-icon hero-icon-meds"
      />
      <img
        src="/img/icons-lg/icon-alerts.png"
        alt="Obtego alerts icon"
        class="hero-icon hero-icon-alerts"
      />
      <img
        src="/img/robot-3d-pointing.png"
        alt="Obtego robot character"
        class="hero-image"
      />
    </div>
  </div>
</section>

<!-- Problem -->
<section class="problem">
  <div class="problem-inner fade-in">
    <span class="section-label">The Problem</span>
    <h2>
      Healthcare's outdated communication model leaves you stuck in the gap.
    </h2>
    <p class="problem-text">
      There's a gap between having medical information and actually
      understanding what it means for you. Whether you're managing your own
      health or helping a loved one navigate theirs, you're an active
      participant in care. Despite this, documents give to you by your
      doctor are often long, filled with Latin jargon, and completely
      unreadable.
    </p>

    <div class="document-mockup">
      <div class="before-after-slider">
        <div class="slider-container">
          <img
            src="/img/report-before.png"
            alt="After: Transformed document"
            class="slider-image slider-before"
          />
          <img
            src="/img/report-after.png"
            alt="Before: Medical document"
            class="slider-image slider-after"
          />
          <div class="slider-handle" id="sliderHandle">
            <div class="slider-handle-line"></div>
            <div class="slider-handle-circle">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M8 9L12 5L16 9M8 15L12 19L16 15"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>
          </div>
          <div class="slider-label slider-label-before">After</div>
          <div class="slider-label slider-label-after">Before</div>
        </div>
      </div>
    </div>

    <div class="document-mockup-mobile">
      <div class="mobile-slider-item">
        <div class="mobile-slider-label">Before: Key Info Buried</div>
        <img
          src="/img/report-before.png"
          alt="Before: Medical document"
          class="mobile-slider-image"
        />
      </div>
      <div class="mobile-slider-item">
        <div class="mobile-slider-label">After: Easy to Understand</div>
        <img
          src="/img/report-after.png"
          alt="After: Transformed document"
          class="mobile-slider-image"
        />
      </div>
    </div>
  </div>
</section>

<!-- Solution -->
<section class="solution" id="how">
  <div class="solution-header fade-in">
    <span class="section-label">A Better Way</span>
    <h2>Turn medical files into human stories</h2>
    <p class="solution-subtitle">
      Obtego takes your medical records and makes them easy to understand
      and explore on your terms.
    </p>
  </div>

  <div class="features">
    <div class="feature-card fade-in">
      <div class="feature-icon">
        <img src="/img/icon-clipboard.png" alt="Clipboard icon" />
      </div>
      <h3>Interactive Summaries</h3>
      <p>
        We extract the key points from dense medical documents so you can
        instantly understand what they found and what you need to do next.
      </p>
    </div>

    <div class="feature-card fade-in">
      <div class="feature-icon">
        <img src="/img/icon-magnifier.png" alt="Magnifier icon" />
      </div>
      <h3>Depth on Demand</h3>
      <p>
        Start with a simple summary. Tap any highlighted term—a diagnosis, a
        medication, a vital sign—and watch it expand into 3D visuals, trend
        graphs, and plain-English explanations.
      </p>
    </div>

    <div class="feature-card fade-in">
      <div class="feature-icon">
        <img src="/img/icon-speech.png" alt="Speech icon" />
      </div>
      <h3>Get Instant Answers</h3>
      <p>
        Have a question about your records? Ask via text or voice and get
        clear explanations grounded in your actual health information.
      </p>
    </div>

    <div class="feature-card fade-in">
      <div class="feature-icon">
        <img src="/img/icon-checkbox.png" alt="Checkbox icon" />
      </div>
      <h3>Clear Follow-ups</h3>
      <p>
        All your follow-up items and "things to watch for" pulled right to
        the front. See them first, so nothing gets lost.
      </p>
    </div>

    <div class="feature-card fade-in">
      <div class="feature-icon">
        <img src="/img/icon-scissors.png" alt="Scissors icon" />
      </div>
      <h3>Snips for Your Doctor</h3>
      <p>
        Think of a question at home but forget it by your appointment? Save
        and organize questions with Snips—ready when you need them.
      </p>
    </div>

    <div class="feature-card fade-in">
      <div class="feature-icon">
        <img src="/img/icon-handshake.png" alt="Handshake icon" />
      </div>
      <h3>Better Conversations</h3>
      <p>
        Arrive at every appointment with your questions organized, your
        concerns documented, and the context to have a real conversation
        about your care.
      </p>
    </div>
  </div>
</section>

<!-- Philosophy -->
<section class="philosophy">
  <div class="philosophy-inner fade-in">
    <blockquote>
      "When you understand what's happening in your body, you stop feeling
      like a passenger in your own care."
    </blockquote>
    <p>
      We believe that true understanding changes everything—how you talk to
      your doctor, how you make decisions, and how you feel about what comes
      next.
    </p>
  </div>
</section>

<!-- How It Works -->
<section class="how-it-works" id="process">
  <div class="how-inner">
    <div class="how-header fade-in">
      <span class="section-label">The Experience</span>
      <h2>Simple for a quick glance. Powerful when you need details.</h2>
    </div>

    <div class="how-content">
      <div class="mobile-mockup-wrapper fade-in">
        <div class="mobile-mockup">
          <div class="mobile-screen">
            <img
              src="/img/mobile-mocks/01-screen-records.png"
              alt="Mobile screen"
              class="mobile-screen-image active"
              data-step="0"
            />
            <img
              src="/img/mobile-mocks/02-screen-visit.png"
              alt="Mobile screen"
              class="mobile-screen-image"
              data-step="1"
            />
            <img
              src="/img/mobile-mocks/03-screen-plan.png"
              alt="Mobile screen"
              class="mobile-screen-image"
              data-step="2"
            />
          </div>
        </div>
      </div>

      <div class="steps">
        <div class="step fade-in" data-step-index="0">
          <span class="step-number">01</span>
          <div class="step-content">
            <h3>Connect your records</h3>
            <p>
              Pull in documents from your hospital portal, receive them from
              your doctor, or simply snap a photo. We handle the rest.
            </p>
          </div>
        </div>

        <div class="step fade-in" data-step-index="1">
          <span class="step-number">02</span>
          <div class="step-content">
            <h3>See what matters</h3>
            <p>
              Get a clear summary of key findings, medications, and next
              steps. Tap any term to explore further with visualizations and
              explanations.
            </p>
          </div>
        </div>

        <div class="step fade-in" data-step-index="2">
          <span class="step-number">03</span>
          <div class="step-content">
            <h3>Stay on track</h3>
            <p>
              Follow-up items appear front and center. Save questions for
              your doctor. One way or another, you'll get answers.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Version: Steps with Individual Screen Images -->
    <div class="how-content-mobile">
      <div class="step-mobile fade-in">
        <div class="step-mobile-image-wrapper">
          <div class="step-mobile-image-container">
            <img
              src="/img/mobile-mocks/01-screen-records.png"
              alt="Connect your records"
              class="step-mobile-image"
            />
          </div>
        </div>
        <div class="step-mobile-content">
          <span class="step-mobile-number">01</span>
          <h3>Connect your records</h3>
          <p>
            Pull in documents from your hospital portal, receive them from
            your doctor, or simply snap a photo. We handle the rest.
          </p>
        </div>
      </div>

      <div class="step-mobile fade-in">
        <div class="step-mobile-image-wrapper">
          <div class="step-mobile-image-container">
            <img
              src="/img/mobile-mocks/02-screen-visit.png"
              alt="See what matters"
              class="step-mobile-image"
            />
          </div>
        </div>
        <div class="step-mobile-content">
          <span class="step-mobile-number">02</span>
          <h3>See what matters</h3>
          <p>
            Get a clear summary of key findings, medications, and next
            steps. Tap any term to explore further with visualizations and
            explanations.
          </p>
        </div>
      </div>

      <div class="step-mobile fade-in">
        <div class="step-mobile-image-wrapper">
          <div class="step-mobile-image-container">
            <img
              src="/img/mobile-mocks/03-screen-plan.png"
              alt="Stay on track"
              class="step-mobile-image"
            />
          </div>
        </div>
        <div class="step-mobile-content">
          <span class="step-mobile-number">03</span>
          <h3>Stay on track</h3>
          <p>
            Follow-up items appear front and center. Save questions for your
            doctor. One way or another, you'll get answers.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- CTA -->
<section class="cta-section" id="signup">
  <div class="cta-inner fade-in">
    <h2>Ready to actually understand your health?</h2>
    <p>
      Be the first to experience Obtego. Join our waitlist for early access
      and updates.
    </p>

    <form class="email-form" id="email-form">
      <input type="email" placeholder="Enter your email" required />
      <button type="submit" class="btn-primary">Get Early Access</button>
    </form>
    <p class="form-note">
      We'll only email you when there's something worth sharing.
    </p>
  </div>
</section>

<!-- Footer -->
<footer>
  <div class="footer-logo">
    <a href="#" class="logo">
      <img src="/img/obtego-logomark.svg" alt="" />
      <span>obtego</span>
    </a>
  </div>
  <p>© 2025 Obtego. Making healthcare engaging.</p>
</footer>

<!-- Video Modal -->
<div id="videoModal" class="video-modal">
  <div class="video-modal-overlay"></div>
  <div class="video-modal-content">
    <button class="video-modal-close" aria-label="Close modal">
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M18 6L6 18M6 6L18 18"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </button>
    <div class="video-modal-iframe-wrapper">
      <iframe
        id="videoIframe"
        src=""
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
      ></iframe>
    </div>
  </div>
</div>

<script>
  // Fade-in on scroll
  const fadeElements = document.querySelectorAll(".fade-in");
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("visible");
        }
      });
    },
    { threshold: 0.1, rootMargin: "0px 0px -50px 0px" }
  );

  fadeElements.forEach((el) => observer.observe(el));

  // Form handling
  const emailForm = document.getElementById("email-form");
  if (emailForm) {
    emailForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const emailInput = emailForm.querySelector('input[type="email"]') as HTMLInputElement;
      const button = emailForm.querySelector("button") as HTMLButtonElement;
      const email = emailInput?.value;
      const originalButtonText = button?.innerHTML;

      if (!email || !button) return;

      // Disable button and show loading state
      button.disabled = true;
      button.innerHTML = "Submitting...";

      try {
        // Create FormData with email
        const formData = new FormData();
        formData.append("email", email);

        // Post to Google Apps Script
        await fetch(
          "https://script.google.com/macros/s/AKfycbwHEEbILn8rb5DOd9hMCUDEnRv2zhvItxOkBAf3n1NPplPPQJOwO9MaG68sctNkbPpf2Q/exec",
          {
            method: "POST",
            body: formData,
            mode: "no-cors", // Required for Google Apps Script
          }
        );

        // Success - update UI
        button.innerHTML = "Thank you! ✓";
        button.style.background = "var(--color-accent-hover)";
        emailInput.value = "";
      } catch (error) {
        // Error handling
        console.error("Error submitting form:", error);
        button.innerHTML = originalButtonText;
        button.disabled = false;
        alert("Something went wrong. Please try again.");
      }
    });
  }

  // Before/After Slider
  const sliderHandle = document.getElementById("sliderHandle");
  const sliderAfter = document.querySelector(".slider-after") as HTMLElement;
  const sliderContainer = document.querySelector(".slider-container") as HTMLElement;

  if (sliderHandle && sliderAfter && sliderContainer) {
    let isDragging = false;
    let rect: DOMRect | null = null;
    let rafId: number | null = null;

    function updateSlider(x: number) {
      if (!rect) {
        rect = sliderContainer.getBoundingClientRect();
      }
      const percentage = Math.max(
        0,
        Math.min(100, ((x - rect.left) / rect.width) * 100)
      );
      sliderAfter.style.clipPath = `inset(0 ${100 - percentage}% 0 0)`;
      sliderHandle!.style.left = `${percentage}%`;
    }

    function handleMove(e: MouseEvent | TouchEvent) {
      if (!isDragging) return;

      if (rafId) {
        cancelAnimationFrame(rafId);
      }

      rafId = requestAnimationFrame(() => {
        const clientX = "touches" in e ? e.touches[0].clientX : e.clientX;
        updateSlider(clientX);
      });
    }

    function startDrag(e: MouseEvent | TouchEvent) {
      isDragging = true;
      rect = sliderContainer.getBoundingClientRect();
      sliderContainer.classList.add("dragging");
      const clientX = "touches" in e ? e.touches[0].clientX : e.clientX;
      updateSlider(clientX);
    }

    function stopDrag() {
      isDragging = false;
      rect = null;
      sliderContainer.classList.remove("dragging");
      if (rafId) {
        cancelAnimationFrame(rafId);
        rafId = null;
      }
    }

    sliderHandle.addEventListener("mousedown", (e) => {
      e.preventDefault();
      startDrag(e);
    });

    sliderContainer.addEventListener("mousedown", (e) => {
      if (
        e.target === sliderContainer ||
        (e.target as HTMLElement).classList.contains("slider-image")
      ) {
        startDrag(e);
      }
    });

    document.addEventListener("mousemove", handleMove);
    document.addEventListener("mouseup", stopDrag);

    // Touch support
    sliderHandle.addEventListener("touchstart", (e) => {
      e.preventDefault();
      startDrag(e);
    });

    sliderContainer.addEventListener("touchstart", (e) => {
      if (
        e.target === sliderContainer ||
        (e.target as HTMLElement).classList.contains("slider-image")
      ) {
        startDrag(e);
      }
    });

    document.addEventListener("touchmove", handleMove, { passive: false });
    document.addEventListener("touchend", stopDrag);
  }

  // Hero Icon Cycling Animation
  const heroIcons = [
    document.querySelector(".hero-icon-schedule"),
    document.querySelector(".hero-icon-meds"),
    document.querySelector(".hero-icon-alerts"),
  ] as HTMLElement[];

  let currentActiveIcon = 0;

  function smoothScaleTransition(element: HTMLElement, targetScale: number, duration = 500) {
    const startScale = parseFloat(
      getComputedStyle(element).getPropertyValue("--icon-scale") || "1"
    );
    const startTime = performance.now();

    function animate(currentTime: number) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const eased = 1 - Math.pow(1 - progress, 3);
      const currentScale = startScale + (targetScale - startScale) * eased;

      element.style.setProperty("--icon-scale", currentScale.toString());

      if (progress < 1) {
        requestAnimationFrame(animate);
      }
    }

    requestAnimationFrame(animate);
  }

  function cycleHeroIcons() {
    heroIcons.forEach((icon, index) => {
      if (!icon) return;
      if (index === currentActiveIcon) {
        icon.classList.add("active");
        smoothScaleTransition(icon, 1.1);
      } else {
        icon.classList.remove("active");
        smoothScaleTransition(icon, 1);
      }
    });

    currentActiveIcon = (currentActiveIcon + 1) % heroIcons.length;
  }

  if (heroIcons[0]) {
    heroIcons[0].classList.add("active");
    heroIcons[0].style.setProperty("--icon-scale", "1.1");
  }

  setInterval(cycleHeroIcons, 2500);

  // Video Modal
  const videoModal = document.getElementById("videoModal");
  const videoModalTrigger = document.getElementById("videoModalTrigger");
  const videoModalClose = document.querySelector(".video-modal-close");
  const videoModalOverlay = document.querySelector(".video-modal-overlay");
  const videoIframe = document.getElementById("videoIframe") as HTMLIFrameElement;
  const youtubeVideoId = "wllRiJJSTpw";
  const youtubeEmbedUrl = `https://www.youtube.com/embed/${youtubeVideoId}?autoplay=1&enablejsapi=1`;

  function openVideoModal() {
    if (!videoModal || !videoIframe) return;
    videoModal.classList.add("active");
    videoIframe.src = youtubeEmbedUrl;
    document.body.style.overflow = "hidden";
  }

  function closeVideoModal() {
    if (!videoModal || !videoIframe) return;
    if (videoIframe.src) {
      videoIframe.contentWindow?.postMessage(
        '{"event":"command","func":"pauseVideo","args":""}',
        "*"
      );
    }
    videoModal.classList.remove("active");
    videoIframe.src = "";
    document.body.style.overflow = "";
  }

  videoModalTrigger?.addEventListener("click", (e) => {
    e.preventDefault();
    openVideoModal();
  });

  videoModalClose?.addEventListener("click", closeVideoModal);
  videoModalOverlay?.addEventListener("click", closeVideoModal);

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && videoModal?.classList.contains("active")) {
      closeVideoModal();
    }
  });

  // Step Click Handler for Mobile Mockup
  const steps = document.querySelectorAll(".step");
  const mobileImages = document.querySelectorAll(".mobile-screen-image");
  let currentActiveStep = 0;

  function switchToStep(stepIndex: number) {
    steps.forEach((step, index) => {
      if (index === stepIndex) {
        step.classList.add("active");
      } else {
        step.classList.remove("active");
      }
    });

    mobileImages.forEach((img, index) => {
      if (index === stepIndex) {
        img.classList.add("active");
      } else {
        img.classList.remove("active");
      }
    });

    currentActiveStep = stepIndex;
  }

  steps.forEach((step, index) => {
    step.addEventListener("click", () => {
      switchToStep(index);
    });
  });

  if (steps.length > 0) {
    switchToStep(0);
  }
</script>

