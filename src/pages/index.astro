---
import { getRelativeLocaleUrl } from 'astro:i18n';

// defaultLocale is "en"
const currentLocale = Astro.currentLocale;
const homeURLZhHans = getRelativeLocaleUrl("zh-hans");
const homeURLEn = getRelativeLocaleUrl("en");

// Locale display names
const localeNames: Record<string, string> = {
  "en": "English",
  "zh-hans": "中文"
};

import "@fontsource-variable/inter";
import 'material-icons/iconfont/material-icons.css';
import "../styles/global.css";
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Obtego | More Engaing Healthcare</title>
	</head>
	<body class="flex flex-col min-h-screen text-emerald-900">
    <nav class="fixed w-full top-0 left-0 flex flex-row-reverse p-4 z-50">
      <div class="flex items-center gap-2">
        <!-- Language Dropdown -->
        <div class="relative">
          <button 
            id="locale-dropdown-button"
            class="flex items-center gap-1 px-3 py-2 text-sm font-medium text-emerald-900 hover:text-slate-800 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 rounded-md cursor-pointer"
            aria-expanded="false"
            aria-haspopup="true"
          >
            <span>{localeNames[currentLocale || "en"]}</span>
            <svg class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          
          <div 
            id="locale-dropdown-menu"
            class="absolute right-0 mt-2 w-32 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none hidden z-50"
            role="menu"
            aria-orientation="vertical"
          >
            <div class="py-1" role="none">
              <a 
                href={homeURLEn}
                class="block px-4 py-2 text-sm text-emerald-900 hover:bg-emerald-100 hover:text-emerald-800 {currentLocale === 'en' ? 'bg-emerald-50 font-medium' : ''}"
                role="menuitem"
              >
                English
              </a>
              <a 
                href={homeURLZhHans}
                class="block px-4 py-2 text-sm text-emerald-900 hover:bg-emerald-100 hover:text-emerald-800 {currentLocale === 'zh-Hans' ? 'bg-emerald-50 font-medium' : ''}"
                role="menuitem"
              >
                中文
              </a>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero -->
    <section
      aria-labelledby="hero-title"
      class="relative isolate overflow-hidden flex-1 flex items-center"
    >
      <div class="relative max-w-3xl xl:ml-48 mx-auto px-6 py-24">
        <img src="/obtego-logo.svg" alt="Obtego" class="h-16" />
        <h1
          id="hero-title"
          class="text-3xl md:text-4xl font-semibold tracking-tight font-serif my-4"
        >
          Your relationship with your healthcare provider should be informative and engaging.
        </h1>
        <div class="relative my-8">
          <form
            id="signup-form"
            data-netlify="true"
            netlify-honeypot="bot-field"
            name="signup"
            method="POST"
          >
            <p class="hidden">
              <label>
                Don't fill this out if you're human: <input name="bot-field" />
              </label>
            </p>
            <input type="email" name="email" id="email" placeholder="Email Address" class="w-full py-2 px-4 rounded-full border-2 border-emerald-900 text-emerald-900 bg-emerald-100 placeholder:text-emerald-900/70" required />
            <button type="submit" class="btn-primary uppercase absolute right-0 top-0 py-2 px-4 border-2 border-emerald-900 hover:cursor-pointer">Notify Me</button>
            <p id="signup-form-error" class="text-red-500 pt-2 hidden">This is an error message.</p>
            <p id="signup-form-success" class="text-green-500 pt-2 hidden">This is a success message.</p>
          </form>
        </div>
        <p class="my-4">The healthcare system was designed for patients with little to no medical information. We transform communication documents like discharge reports and after visit summaries into interactive experiences so you can understand your medical care.</p>
        <table class="w-full md:table hidden">
          <thead>
            <tr>
              <th class="text-2xl font-semibold font-serif text-left pb-4">Status Quo</th>
              <th class="text-2xl font-semibold font-serif text-left pb-4">Better Future</th>
            </tr>
          </thead>
          <tbody class="space-y-4">
            <tr class="align-top">
              <td class="pr-4 pb-4">• 10-15 minute visits with little to no time for questions</td>
              <td class="pb-4">• Doctors have the tools to co-create understanding with patients</td>
            </tr>
            <tr class="align-top">
              <td class="pr-4 pb-4">• Documentation optimized for billing & compliance, not understanding</td>
              <td class="pb-4">• Communication designed for patient comprehension and empowerment</td>
            </tr>
            <tr class="align-top">
              <td class="pr-4 pb-4">• Static discharge summaries and portal PDFs that are difficult to interpret</td>
              <td class="pb-4">• Interactive, explorable stories of your medical episodes</td>
            </tr>
          </tbody>
        </table>
        <div class="md:hidden">
          <h2 class="text-2xl font-semibold font-serif text-left my-4">Status Quo</h2>
          <ul class="list-disc list-inside">
            <li>10-15 minute visits with little to no time for questions</li>
            <li>Documentation optimized for billing & compliance, not understanding</li>
            <li>Static discharge summaries and portal PDFs that are difficult to interpret</li>
          </ul>
          <h2 class="text-2xl font-semibold font-serif text-left my-4">Better Future</h2>
          <ul class="list-disc list-inside">
            <li>Doctors have the tools to co-create understanding with patients</li>
            <li>Communication designed for patient comprehension and empowerment</li>
            <li>Interactive, explorable stories of your medical episodes</li>
          </ul>
        </div>
      </div>
    </section>

    <footer
      class="py-8 text-center text-sm text-emerald-900"
    >
      © <span id="year"></span> Obtego
    </footer>

    <!-- Minimal JS for role-based reordering (no content hidden) and 'How it works' expanders -->
    <script>
      /*
       * Footer year
       */

      document.getElementById("year")!.textContent = new Date().getFullYear().toString();

			/*
			 * Locale Dropdown
			 */

			function initLocaleDropdown() {
				const dropdownButton = document.getElementById('locale-dropdown-button');
				const dropdownMenu = document.getElementById('locale-dropdown-menu');
				const dropdownIcon = dropdownButton?.querySelector('svg');

				if (!dropdownButton || !dropdownMenu) return;

				// Toggle dropdown
				function toggleDropdown() {
					if (!dropdownMenu) return;
					const isOpen = !dropdownMenu.classList.contains('hidden');
					
					if (isOpen) {
						closeDropdown();
					} else {
						openDropdown();
					}
				}

				// Open dropdown
				function openDropdown() {
					if (!dropdownMenu || !dropdownButton) return;
					dropdownMenu.classList.remove('hidden');
					dropdownButton.setAttribute('aria-expanded', 'true');
					if (dropdownIcon) {
						dropdownIcon.style.transform = 'rotate(180deg)';
					}
				}

				// Close dropdown
				function closeDropdown() {
					if (!dropdownMenu || !dropdownButton) return;
					dropdownMenu.classList.add('hidden');
					dropdownButton.setAttribute('aria-expanded', 'false');
					if (dropdownIcon) {
						dropdownIcon.style.transform = 'rotate(0deg)';
					}
				}

				// Event listeners
				dropdownButton.addEventListener('click', (e) => {
					e.preventDefault();
					e.stopPropagation();
					toggleDropdown();
				});

				// Close dropdown when clicking outside
				document.addEventListener('click', (e) => {
					if (!dropdownButton.contains(e.target as Node) && !dropdownMenu.contains(e.target as Node)) {
						closeDropdown();
					}
				});

				// Close dropdown on escape key
				document.addEventListener('keydown', (e) => {
					if (e.key === 'Escape') {
						closeDropdown();
					}
				});
			}

			// Initialize dropdown when DOM is loaded
			document.addEventListener('DOMContentLoaded', initLocaleDropdown);

      /*
       * Form Submission
       */

      const handleSubmit = (event: Event) => {
        event.preventDefault();

        const myForm = event.target;
        const formData = new FormData(myForm as HTMLFormElement);

        fetch("/", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams(formData as unknown as Record<string, string>).toString()
        })
          .then(() => {
            const successElement = document.getElementById("signup-form-success") as HTMLParagraphElement;
            if (successElement) {
              successElement.classList.remove("hidden");
              successElement.textContent = "Thank you for your interest! We'll be in touch soon.";
            }
          })
          .catch(error => {
            console.error(error);
            const errorElement = document.getElementById("signup-form-error") as HTMLParagraphElement;
            if (errorElement) {
              errorElement.classList.remove("hidden");
              errorElement.textContent = "There was an error submitting the form. Please try again.";
            }
          });
      };

      document.getElementById("signup-form")?.addEventListener("submit", handleSubmit);
    </script>
  </body>
</html>
